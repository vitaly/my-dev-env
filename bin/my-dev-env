#!/bin/bash

D="$(dirname "$(readlink "${BASH_SOURCE[0]}")")"
R="$(cd "$D/../"; pwd)"

function mounts()
{
  echo -e "-v\n/:/work"
  echo -e "-w\n/work/$PWD"
  cd "$R/mounts"
  find . -type l |\
    while read f; do
      echo -e "-v\n$(readlink "$f"):/$f"
    done
}

# this properly handles mounts with spaces in both target and source
MOUNTS=()
while read m; do
  MOUNTS+=("$m")
done < <(mounts)

(set -x; docker run --rm -ti "${MOUNTS[@]}" my-dev-env "$@")